---
title: "Phenotype Pipeline"
---
<div style="display: flex; justify-content: space-between; align-items: center;">
  <a href="./index.html">⬅️ Return to Homepage</a>
  <a href="./gwas.html">Go to Step 4 [Genome Wide Association Study] ➡️</a>
</div>

## Overview

This repository provides a containerized pipeline for QC and deriviation of phenotype data for subsequent GWAS analysis.

## Usage

1. **Edit `parameters.txt`** to set filenames and options for your data. This includes mapping column names to data labels that can be interpreted by the pipeline.

2. ** Run the bash script that will run the docker

```bash
# Run container using Apptainer
bash PHENOTYPE_PIPELINE.sh --apptainer

# Run container using Singulairty
bash PHENOTYPE_PIPELINE.sh --singulairty
```

## Details

### Expected input files to the script
The script expects 3 files for input to be specified in the `parameters.txt` file.
```
## Filename containing phenotype and covariate data (required)
PHENO_COV_FILE="/path/to/PhenoCovars.txt"

## Filename containing ancestry labels [AFR|AMR|EAS|EUR|MID|SAS] (required)
ANCESTRY_FILE="/path/to/Ancestries.txt"

## Filename containing 20 study-level PCs generated by FLASH PCA (required)
PCS_FILE="/path/to/FlashPCAStudyPCA.txt"
```

#### Phenotype + Covariate File
The script expects a file that contains all variables for phenotype derivation for height, BMI and WHR, and all associated covariates. 

```
ID    Age   Sex  Height  Weight  Waist  Hip    CatVar1  CatVar2  CatVar3
P1    25    2    99      75.6    89     100    0        1        1
P2    85    1    170     89.8    91     98     1        1        2
P3    36    2    159     91.1    84     1020   0        2        3
...
```



### Derivation of phenotypes
Where possible, please provide variables to derive phenotypes are required:

| Phenotype | Variables to priortise if available |
| :---: | :---: |
| HEIGHT | height (cm) |
| BMI | height (cm), weight (kg) |
| WHR | waist circumference (cm), hip circumference (cm) |

Note, WHR adjusted for BMI GWAS will be derived by the pipeline.

Variables used to derive BMI and WHR will first undergo QC prior to derivation of BMI and WHR that will subsequently be QC'd again.
If you do not have measures of weight, waist and/or hip, pre-derived values for BMI and WHR can be used and these will be QC'd.

To account for the nature of EHR-based studies and other longitudinal studies, the pipeline allows for multiple measures of BMI and WHR to be provied. 

Specifically, two sets of variables may be provided for BMI if the variables used to derive primary BMI for GWAS and BMI used to adjust for WHR were measured at different times. 
Similary, two sets of variables may be provided for WHR if the variables used to derive primary WHR for GWAS and WHR adjusted for BMI  were measured at different times. 
As a result, the pipeline allows for different ages for height, BMI, WHR and WHRadjBMI to be provided.



The output from this workflow will include:

* a file for REGENIE containing values of ancestry-specific male and female inverse-normalised residuals.
* a file for REGENIE containing continuous and categorical covariates specific to genotyping that were not incoporated into the residuals (if applicable)
* tab delimited summaries of the phenotypes processed for GWAS
* visualisation of raw, QCd', residualsised, and inverse-normalised values
* sample lists for REGENIE that correspond to ancestry- and sex-stratified GWAS analysis
