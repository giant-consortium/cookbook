---
---
<div style="display: flex; justify-content: space-between; align-items: center;">
  <a href="./index.html">⬅️ Return to Homepage</a>
  <a href="./post_gwas_checks.html">Go to Step 5 [Post-GWAS QC Checks] ➡️</a>
</div>

# Genome Wide Association Analysis

This pipeline uses [REGENIE](https://rgcgithub.github.io/regenie/) software to perform genome-wide association analysis.
The following steps are performed when running the pipeline :

- Conversion of imputed genomic data (.vcf) to plink2 pgen/pvar/psam format (likely one set per chromosome)
- Step 1 of REGENIE using genomic data before imputation
- Step 2 of REGENIE using the converted imputed data
- Concatenation of REGENIE step 2 outputs into one single genome-wide output file

## Run pipeline using docker or apptainer (singularity)

### Clone GitHub repo

```bash
 git clone https://github.com/giant-consortium/association_analysis.git
```

### Download docker/apptainer container

Once inside the `association_analysis` repo, run the following command needed to download either docker or apptainer file :

#### Docker
```bash
wget -L https://storage.googleapis.com/giant_deeper_imputation/docker_containers/step4_assoc.tar .

chmod 777 step4_assoc.tar
```

#### Apptainer
```bash
wget -L https://storage.googleapis.com/giant_deeper_imputation/singularity_containers/step4_assoc.sif .

chmod 777 step4_assoc.sif
```

### Update parameters and paths to input files

Modify the `parameters_gwas.txt` file with your input file names and parameters to be used to run the GWAS, see main inputs needed below.

#### In/Out paths 
- path_to_data : your local path where to find the input qced array files (bed, bim, fam)   
- path_to_imputed_data : your local path where to find the imputed data files (vcf)   
- path_to_output_dir : your local path for output files (will be created if it does not exist yet)  

#### REGENIE step 1/2 parameters
- `study_QC_name` : Always set study_name to match the base name of your PLINK files (no file extensions). The pipeline accepts files in .bed/.bim/.fam.  
- `output_prefix` : Study name you want to use as prefix for outputs generated by this pipeline. For each input genetic file going to step2 (eg chrN), the resulting output filename will be output_prefix_chrN.regenie    
- `path_to_pheno_file` : path to the phenotype file. The phenotype file is a tab-delimited file starting with the 2 columns FID IID and other columns containing your phenotype data. See [regenie documentation](https://rgcgithub.github.io/regenie/options/#phenotype-file-format) for file format.   
- `pheno_col` : columns from the phenotype file to run gwas on (`pheno_col`): column names without quotes, separated by commas (no spaces)   
- `path_to_covar_file` : path to covariate file, The covariate file is a tab-delimited file starting with the 2 columns FID IID and other columns containing your covariates. See [regenie documentation](https://rgcgithub.github.io/regenie/options/#covariate-file-format) for file format   
- `cont_covar_col` : columns referring to **continuous** covariates from the covariate file, to be used for the gwas (`cont_covar_col`) : column names without quotes, separated by commas (no spaces)
- `cat_covar_col` : columns referring to **categorical** covariates from the covariate file, to be used for the gwas (`cat_covar_col`) : column names without quotes, separated by commas (no spaces)
- `path_to_samples_to_keep` : path to the keep file. The keep file is a tab-delimited file with 2 columns containing the participants FID and IID that you want to use in your gwas, but no colnames

### Launch pipeline 

Run with docker
```bash
./assoc_pipeline_runner.sh docker
```
Run with apptainer
```bash
./assoc_pipeline_runner.sh apptainer
```
